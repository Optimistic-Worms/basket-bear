sudo: required
services:
- docker
before_install:
  - docker --version  # document the version travis is using
  - pip install --user awscli # install aws cli w/o sudo
  - export PATH=$PATH:$HOME/.local/bin # put aws in the path
  - eval $(aws ecr get-login --region us-east-1) #needs AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY envvars
install:
- docker build -t basket .
script:
- docker run -it -p 8000:8000 basket npm test
deploy:
  provider: elasticbeanstalk
  access_key_id: ${AWS_ACCESS_KEY_ID}
  secret_access_key:
    secure: ${AWS_SECRET_ACCESS_KEY}
  region: us-east-1
  app: basket
  env: staging
  bucket_name: elasticbeanstalk-us-east-1-767596259046
  on:
    condition: "$TRAVIS_PULL_REQUEST == 'false'"